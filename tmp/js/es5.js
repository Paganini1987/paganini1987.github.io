"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t,n){function o(e,t){return _typeof(e)===t}function s(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):d?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function c(){var e=t.body;return e||((e=s(d?"svg":"body")).fake=!0),e}var a=[],r=[],i={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){r.push({name:e,fn:t,options:n})},addAsyncTest:function(e){r.push({name:null,fn:e})}},l=function(){};l.prototype=i,l=new l;var u=t.documentElement,d="svg"===u.nodeName.toLowerCase(),p=i._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];i._prefixes=p;var h=i.testStyles=function(e,n,o,a){var r,i,l,d,p="modernizr",h=s("div"),f=c();if(parseInt(o,10))for(;o--;)(l=s("div")).id=a?a[o]:p+(o+1),h.appendChild(l);return(r=s("style")).type="text/css",r.id="s"+p,(f.fake?f:h).appendChild(r),f.appendChild(h),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e)),h.id=p,f.fake&&(f.style.background="",f.style.overflow="hidden",d=u.style.overflow,u.style.overflow="hidden",u.appendChild(f)),i=n(h,e),f.fake?(f.parentNode.removeChild(f),u.style.overflow=d,u.offsetHeight):h.parentNode.removeChild(h),!!i};l.addTest("touchevents",function(){var n;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)n=!0;else{var o=["@media (",p.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");h(o,function(e){n=9===e.offsetTop})}return n}),function(){var e,t,n,s,c,i;for(var u in r)if(r.hasOwnProperty(u)){if(e=[],(t=r[u]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(s=o(t.fn,"function")?t.fn():t.fn,c=0;c<e.length;c++)1===(i=e[c].split(".")).length?l[i[0]]=s:(!l[i[0]]||l[i[0]]instanceof Boolean||(l[i[0]]=new Boolean(l[i[0]])),l[i[0]][i[1]]=s),a.push((s?"":"no-")+i.join("-"))}}(),function(e){var t=u.className,n=l._config.classPrefix||"";if(d&&(t=t.baseVal),l._config.enableJSClass){var o=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(o,"$1"+n+"js$2")}l._config.enableClasses&&(t+=" "+n+e.join(" "+n),d?u.className.baseVal=t:u.className=t)}(a),delete i.addTest,delete i.addAsyncTest;for(var f=0;f<l._q.length;f++)l._q[f]();e.Modernizr=l}(window,document),document.addEventListener("DOMContentLoaded",function(){({elCalc:document.querySelector(".js-calc"),elForm:document.querySelector(".js-form"),elSuccess:document.querySelector(".js-success"),currentStep:0,currentRoute:"Диван",steps:null,routes:{"Диван":["Что выбираете?","Какая комплектация дивана вас интересует?","Выберите расположение спального места","Выберите тип материала","Где планируете поставить?","finish"],"Кресло":["Что выбираете?","Какой тип кресла вас интересует?","Выберите тип материала","Где планируете поставить?","finish"],"Кровать":["Что выбираете?","Наличие подъемного механизма?","Выберите тип материала","Выберите размер спального места","finish"],"Матрас":["Что выбираете?","Выберите жесткость матраса","Выберите размер спального места","finish"]},data:{"Что выбираете?":["Диван"]},phone:"",phoneMask:null,phoneMask2:null,controller:function(){var e=this,t=this.routes[this.currentRoute][this.currentStep];[].forEach.call(this.steps,function(n){t==n.dataset.step&&(e.showStep(n),e.setProgress(),e.checkButtons(),e.validation())})},validation:function(){var e=this.routes[this.currentRoute][this.currentStep];return e in this.data&&this.data[e].length>0?(this.statusNext(!0),!0):(this.statusNext(!1),!1)},statusNext:function(e){var t=document.querySelector(".js-next-step");e?t.classList.remove("invalid"):t.classList.add("invalid")},progress:function(){return Math.round(this.currentStep/(this.routes[this.currentRoute].length-2)*100)},setProgress:function(){var e=document.querySelector(".js-set-progress"),t=document.querySelector(".js-set-indicator"),n=document.querySelector(".w-progress");e.innerHTML=this.progress(),t.style.width=this.progress()+"%",0===this.progress()?n.classList.add("null"):n.classList.remove("null")},showStep:function(e){[].forEach.call(this.steps,function(e){e.hidden=!0}),e.hidden=!1},getDataStep:function(e){return e.closest(".js-step").dataset.step},checkButtons:function(){var e=document.querySelector(".js-prev-step"),t=(document.querySelector(".js-next-step"),document.querySelector(".w__footer"));this.currentStep===this.routes[this.currentRoute].length-1?t.hidden=!0:t.hidden=!1,0===this.currentStep?e.hidden=!0:e.hidden=!1},openCalc:function(){this.elCalc.classList.add("isOpened")},closeCalc:function(){this.elCalc.classList.remove("isOpened"),this.refreshCalc()},openForm:function(){this.elForm.classList.add("isOpened")},closeForm:function(){this.elForm.classList.remove("isOpened")},openSuccess:function(){this.elSuccess.classList.add("isOpened")},closeSuccess:function(){this.elSuccess.classList.remove("isOpened")},refreshCalc:function(){this.currentStep=0,this.currentRoute="Диван",this.data={"Что выбираете?":["Диван"]};var e=document.querySelectorAll(".js-input");[].forEach.call(e,function(e){e.checked=!1,"Диван"===e.value&&(e.checked=!0)}),document.querySelector(".js-input-input").value="",document.querySelector(".js-calc-accept").checked=!1,this.phoneMask.typedValue="",this.controller()},clearInputs:function(){var e=document.querySelectorAll(".js-input");[].forEach.call(e,function(e){"firststep"!==e.name&&(e.checked=!1)}),document.querySelector(".js-input-input").value=""},sendData:function(e){return fetch("/ajax/widgetSend.php",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)})},init:function(){var e=this;this.steps=document.querySelectorAll(".js-step"),document.querySelector(".js-next-step").addEventListener("click",function(){var t=e.routes[e.currentRoute].length;if(!e.validation())return alert("Пожалуйста, заполните необходимые поля"),null;e.currentStep<t-1&&e.currentStep++,e.controller()}),document.querySelector(".js-prev-step").addEventListener("click",function(t){e.currentStep>0&&e.currentStep--,e.controller()}),document.querySelector(".js-submit").addEventListener("click",function(t){document.querySelector(".js-calc-accept").checked&&"Телефон"in e.data&&""!==e.data["Телефон"]?e.sendData(e.data).then(function(t){if(!t.ok)throw new Error;e.openSuccess(),e.closeCalc(),setTimeout(function(){e.closeSuccess()},7e3)}).catch(function(e){alert("Произошла ошибка отправки формы, повторите попытку позднее."),console.log(e)}):alert("Пожалуйста, заполните необходимые поля")}),document.querySelector(".js-submit-2").addEventListener("click",function(t){document.querySelector(".js-form-accept").checked&&""!==e.phone?e.sendData(e.phone).then(function(t){if(!t.ok)throw new Error;e.openSuccess(),e.closeForm(),setTimeout(function(){e.closeSuccess()},7e3)}).catch(function(e){alert("Произошла ошибка отправки формы, повторите попытку позднее."),console.log(e)}):alert("Пожалуйста, заполните необходимые поля")}),document.addEventListener("change",function(t){if(t.target.classList.contains("js-input")){var n=t.target,o=e.getDataStep(n),s=t.target.checked;"Что выбираете?"===o?(e.clearInputs(),e.currentRoute=n.value,e.data={},e.data[o]=[n.value]):o in e.data?"checkbox"===n.type?s?e.data[o].push(n.value):e.data[o].splice(e.data[o].indexOf(n.value),1):"radio"===n.type?s&&(e.data[o]=[],e.data[o].push(n.value)):e.data[o]=[n.value]:(e.data[o]=[],"checkbox"!==n.type&&"radio"!==n.type||s&&e.data[o].push(n.value))}e.validation()}),document.addEventListener("input",function(t){if(t.target.classList.contains("js-input-input")){var n=t.target,o=e.getDataStep(n);""!==n.value?e.data[o]=[n.value]:e.data[o]=[]}e.validation()}),document.addEventListener("click",function(t){var n=t.target.closest(".s-panel__item"),o="";n&&n.classList.contains("s-panel__item")&&("calc"==(o=n.dataset.item)&&e.openCalc(),"form"==o&&e.openForm(),"bonus"==o&&(window.location="https://formula-divana.ru/bonus/"))}),document.querySelector(".js-calc-close").addEventListener("click",function(t){t.preventDefault(),e.closeCalc()}),document.querySelector(".js-form-close").addEventListener("click",function(t){t.preventDefault(),e.closeForm()}),document.querySelector(".js-success-close").addEventListener("click",function(t){t.preventDefault(),e.closeSuccess()}),this.phoneMask=IMask(document.getElementById("tel"),{mask:"+{7 }(000)000-00-00",lazy:!1,placeholderChar:"_"}),this.phoneMask.on("accept",function(){e.data["Телефон"]=""}),this.phoneMask.on("complete",function(){e.data["Телефон"]=e.phoneMask.value}),this.phoneMask2=IMask(document.getElementById("tel2"),{mask:"+{7 }(000)000-00-00",lazy:!1,placeholderChar:"_"}),this.phoneMask2.on("accept",function(){e.phone=""}),this.phoneMask2.on("complete",function(){e.phone=e.phoneMask2.value}),this.controller()}}).init()}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t;){if(t.matches(e))return t;t=t.parentElement}return null});